<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Voronoi">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voronoi</title>
    <style>
        svg text {
            font-size: 4px;
        }
    </style>
</head>
<body>
    <svg id="svg" width="400" height="400" viewBox="0 0 100 100"></svg>
    <svg id="svg2" width="400" height="400" viewBox="0 0 100 100"></svg>
    <svg id="svg3" width="400" height="400" viewBox="0 0 100 100"></svg>

    <script type="module">
        import {Generator, Line, Point, Polygon} from "./core.js"
        import * as powerDiagram from "./power-diagram.js"
        import * as centroidalVoronoi from "./centroidal-voronoi.js"
        import * as adaptiveVoronoi from "./adaptive-voronoi.js"

        const boundPolygon = new Polygon([new Point(0, 0), new Point(100, 0), new Point(100, 100), new Point(0, 100)])
        const generators = [
            new Generator(20, 20, 100),
            new Generator(40, 20, 10),
            new Generator(60, 20, 200),
            new Generator(80, 20, 60),

            new Generator(20, 40, 170),
            new Generator(40, 40, 110),
            new Generator(60, 40, 30),
            new Generator(80, 40, 90),
            
            new Generator(20, 60, 600),
            new Generator(40, 60, 120),
            new Generator(60, 60, 120),
            new Generator(80, 60, 10),

            new Generator(20, 80, 340),
            new Generator(40, 80, 300),
            new Generator(60, 80, 200),
            new Generator(80, 80, 100),
        ]
        drawCells("svg", powerDiagram.calculate(boundPolygon, generators))
        drawCells("svg2", centroidalVoronoi.calculate(boundPolygon, generators, powerDiagram.calculate))
        drawCells("svg3", adaptiveVoronoi.calculate(boundPolygon, generators, powerDiagram.calculate))

        
        function drawCells(elementId, cells) {
            const colors = [
                "blue",
                "brown",
                "coral",
                "green",
                "grey",
                "orange",
                "red",
                "yellow",
            ]

            const svg = document.getElementById(elementId)
            cells.forEach((cell, index) => {
                svg.appendChild(polygonElement(cell.vertices, colors[index % colors.length], "white"))

                const Generator = generators[index]
                svg.appendChild(textElement(Generator.x, Generator.y, Generator.weight))
            })

            function polygonElement(points, fill = "none", stroke = "black") {
                const element = document.createElementNS("http://www.w3.org/2000/svg", "polygon")
                element.setAttribute("points", points.map(v => `${v.x},${v.y}`).join(" "))
                element.setAttribute("fill", fill)
                element.setAttribute("stroke", stroke)
                return element
            }

            function textElement(x, y, text) {
                const element = document.createElementNS("http://www.w3.org/2000/svg", "text")
                element.setAttribute("x", x)
                element.setAttribute("y", y)
                element.textContent = text
                return element
            }
        }
    </script>        
</body>
</html>
