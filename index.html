<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Voronoi">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voronoi</title>
    <style>
        svg text {
            font-size: 4px;
        }
    </style>
</head>
<body>
    <svg id="svg" width="400" height="400" viewBox="0 0 100 100"></svg>
    <svg id="svg2" width="400" height="400" viewBox="0 0 100 100"></svg>
    <svg id="svg3" width="400" height="400" viewBox="0 0 100 100"></svg>

    <script type="module">
        import {Generator, Line, Point, Polygon} from "./core.js"
        import * as powerDiagram from "./power-diagram.js"
        import * as centroidalVoronoi from "./centroidal-voronoi.js"

        const boundPolygon = new Polygon([new Point(0, 0), new Point(100, 0), new Point(100, 100), new Point(0, 100)])
        const generators = [
            new Generator(rand(), rand(), rand()),
            new Generator(rand(), rand(), rand()),
            new Generator(rand(), rand(), rand()),
            new Generator(rand(), rand(), rand()),
            new Generator(rand(), rand(), rand()),
            new Generator(rand(), rand(), rand()),
            new Generator(rand(), rand(), rand()),
            new Generator(rand(), rand(), rand()),
            new Generator(rand(), rand(), rand()),
            new Generator(rand(), rand(), rand()),
        ]
        drawCells("svg", powerDiagram.calculate(boundPolygon, generators))
        drawCells("svg2", centroidalVoronoi.calculate(boundPolygon, generators, powerDiagram.calculate))

        function rand() {
            return Math.floor(Math.random() * 100)
        }
        
        function drawCells(elementId, cells) {
            const colors = [
                "blue",
                "brown",
                "coral",
                "green",
                "grey",
                "orange",
                "red",
                "yellow",
            ]

            const svg = document.getElementById(elementId)
            cells.forEach((cell, index) => {
                svg.appendChild(polygonElement(cell.vertices, colors[index % colors.length], "white"))

                const centroid = cell.centroid()
                const generator = generators[index]
                svg.appendChild(textElement(centroid.x, centroid.y, generator.weight))
            })

            function polygonElement(points, fill = "none", stroke = "black") {
                const element = document.createElementNS("http://www.w3.org/2000/svg", "polygon")
                element.setAttribute("points", points.map(v => `${v.x},${v.y}`).join(" "))
                element.setAttribute("fill", fill)
                element.setAttribute("stroke", stroke)
                return element
            }

            function textElement(x, y, text) {
                const element = document.createElementNS("http://www.w3.org/2000/svg", "text")
                element.setAttribute("x", x)
                element.setAttribute("y", y)
                element.textContent = text
                return element
            }
        }
    </script>        
</body>
</html>
